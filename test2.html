<!doctype html>
<html>
<body>
	<script>
		var oDPAPI;
		var sConfigurationId,sTransactionId,sButtonDivId = "payment_buttons";
		
		function loadAPI() {
			var sLoaderUrl = document.getElementById("LoaderUrl").value;
			var sAPISessionId = document.getElementById("APISessionId").value;
			sConfigurationId = document.getElementById("ConfigId").value;
			sTransactionId = document.getElementById("TransactionId").value;
			
			var script = document.createElement('script');
			script.onload = function() {
				var oLoaderPromise = com.sap.fin.digital.payments.jslib.Loader.initLibrary(sAPISessionId);
				oLoaderPromise.then(function(oAPI) {
					oDPAPI = oAPI;
					console.log("DPJSLib API loaded successfully!");
					getPaymentTypes();
				}).catch(function(oError) {
					handleError(oError);
				});
			};
			script.id = "com.sap.digital.payments.jslib.loader";
			script.src = sLoaderUrl;
			document.head.appendChild(script);
		}

		
		function getPaymentTypes() {
			var oPaymentTypesPromise = oDPAPI.loadPaymentTypes(sConfigurationId, sTransactionId, sButtonDivId);

			oPaymentTypesPromise.then(function(aPaymentTypes) {
				makeRadioButtons(aPaymentTypes);
			}).catch(function(oError) {
				handleError(oError);
			});
		}
		
		function onPaymentTypeSelected(oEvent) {
			var sPaymentType = oEvent.srcElement.value;
			var oPaymentPromise = oDPAPI.selectPaymentType(sPaymentType);
			
			oPaymentPromise.then(function(sTransactionByPaytSrvcPrvdr) {
				console.log(`Inform backend to call /core/v2/paymentpage/finalize to finalize transaction. Payment Id at PSP: ${sTransactionByPaytSrvcPrvdr}`);
			}).catch(function(oError) { 
				handleError(oError);
			});
		}
		

		function makeRadioButtons(aPaymentTypes) {
			aPaymentTypes.forEach(function(oPaymentType) {
				var label = document.createElement("label"), radio = document.createElement("input");
				radio.type = "radio";
				radio.name = "paymentTypes";
				radio.value = oPaymentType.PaymentType;
				radio.addEventListener('change', onPaymentTypeSelected);
				label.appendChild(radio);
				label.appendChild(document.createTextNode(oPaymentType.Name));
				document.getElementById("payment_types").appendChild(label);
			});
		}
		
		function handleError(oError) {
			if (!oError) {
				console.log("unexpected error occurred");
			}
			if (oError && oError.message) {
				console.log(oError.message);
			}
			if (oError && oError.ErrorConsumer) {
				console.log(oError.ErrorConsumer.ErrorId);
			}
		}
	</script>


	<br> LoaderUrl <input id="LoaderUrl" value="http://localhost:10000/dpjslib/latest/loader.min.js" size="100">
	<br> APISessionId <input id="APISessionId" value="" size="100">
	<br>TransactionId <input id="TransactionId" value="" size="100">
	<br>ConfigId <input id="ConfigId" value="config1" size="100">
	<br>
	<br><button onClick="loadAPI()">Load Payment Buttons</button><br>
	<br><div id="payment_types"></div><br>
	<br><div id="payment_buttons"></div><br>

</body>
</html>
